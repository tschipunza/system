<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Card - {{ job_card.job_card_number }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none; }
            body { margin: 0; padding: 20px; }
        }
        body { font-size: 12px; }
        .job-card-header { 
            border-bottom: 3px solid #333; 
            padding-bottom: 15px; 
            margin-bottom: 20px;
        }
        .section-title {
            background-color: #f0f0f0;
            padding: 5px 10px;
            margin-top: 15px;
            margin-bottom: 10px;
            font-weight: bold;
            border-left: 4px solid #333;
        }
        table { font-size: 11px; }
        .signature-box {
            border: 1px solid #333;
            padding: 40px 20px 10px 20px;
            margin-top: 30px;
            text-align: center;
        }
        .company-logo {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Print Button -->
        <div class="no-print mb-3 text-end">
            <button onclick="window.print()" class="btn btn-primary">
                <i class="fas fa-print"></i> Print Job Card
            </button>
            <button onclick="window.close()" class="btn btn-secondary">
                Close
            </button>
        </div>

        <!-- Header -->
        <div class="job-card-header">
            <div class="row">
                <div class="col-8">
                    <div class="company-logo">VEHICLE MANAGEMENT SYSTEM</div>
                    <p class="mb-0">Service Job Card</p>
                </div>
                <div class="col-4 text-end">
                    <h4 class="mb-0">{{ job_card.job_card_number }}</h4>
                    <p class="mb-0">
                        <span class="badge bg-{% if job_card.status == 'completed' %}success{% elif job_card.status == 'in_progress' %}info{% elif job_card.status == 'on_hold' %}warning{% else %}secondary{% endif %}">
                            {{ job_card.status|replace('_', ' ')|title }}
                        </span>
                        <span class="badge bg-{% if job_card.priority == 'urgent' %}danger{% elif job_card.priority == 'high' %}warning{% else %}secondary{% endif %}">
                            {{ job_card.priority|title }}
                        </span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Vehicle & Customer Info -->
        <div class="row">
            <div class="col-6">
                <div class="section-title">VEHICLE INFORMATION</div>
                <table class="table table-sm table-bordered">
                    <tr>
                        <td width="40%"><strong>Registration:</strong></td>
                        <td>{{ job_card.vehicle_number }}</td>
                    </tr>
                    <tr>
                        <td><strong>Make/Model:</strong></td>
                        <td>{{ job_card.make }} {{ job_card.model }}</td>
                    </tr>
                    <tr>
                        <td><strong>Year:</strong></td>
                        <td>{{ job_card.year }}</td>
                    </tr>
                    <tr>
                        <td><strong>Color:</strong></td>
                        <td>{{ job_card.color if job_card.color else 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Odometer In:</strong></td>
                        <td>{{ job_card.odometer_in if job_card.odometer_in else 'N/A' }} km</td>
                    </tr>
                    <tr>
                        <td><strong>Odometer Out:</strong></td>
                        <td>{{ job_card.odometer_out if job_card.odometer_out else 'N/A' }} km</td>
                    </tr>
                    <tr>
                        <td><strong>Fuel Level:</strong></td>
                        <td>{{ job_card.fuel_level if job_card.fuel_level else 'Not recorded' }}</td>
                    </tr>
                </table>
            </div>
            <div class="col-6">
                <div class="section-title">CUSTOMER INFORMATION</div>
                <table class="table table-sm table-bordered">
                    <tr>
                        <td width="40%"><strong>Name:</strong></td>
                        <td>{{ job_card.customer_name if job_card.customer_name else 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Phone:</strong></td>
                        <td>{{ job_card.customer_phone if job_card.customer_phone else 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Email:</strong></td>
                        <td>{{ job_card.customer_email if job_card.customer_email else 'N/A' }}</td>
                    </tr>
                </table>

                <div class="section-title mt-3">SERVICE TIMELINE</div>
                <table class="table table-sm table-bordered">
                    <tr>
                        <td width="40%"><strong>Date In:</strong></td>
                        <td>{{ job_card.date_in.strftime('%Y-%m-%d %H:%M') }}</td>
                    </tr>
                    <tr>
                        <td><strong>Expected:</strong></td>
                        <td>{{ job_card.expected_completion.strftime('%Y-%m-%d %H:%M') if job_card.expected_completion else 'Not set' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Date Out:</strong></td>
                        <td>{{ job_card.date_out.strftime('%Y-%m-%d %H:%M') if job_card.date_out else 'Not completed' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Technician:</strong></td>
                        <td>{{ job_card.technician_name if job_card.technician_name else 'Unassigned' }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Issues & Diagnosis -->
        <div class="section-title">REPORTED ISSUES</div>
        <div class="border p-2 mb-2" style="min-height: 60px;">
            {{ job_card.reported_issues if job_card.reported_issues else 'No issues reported' }}
        </div>

        {% if job_card.diagnosis %}
        <div class="section-title">DIAGNOSIS</div>
        <div class="border p-2 mb-2" style="min-height: 50px;">
            {{ job_card.diagnosis }}
        </div>
        {% endif %}

        {% if job_card.recommended_services %}
        <div class="section-title">RECOMMENDED SERVICES</div>
        <div class="border p-2 mb-2" style="min-height: 50px;">
            {{ job_card.recommended_services }}
        </div>
        {% endif %}

        <!-- Parts & Labor -->
        {% if items %}
        <div class="section-title">PARTS & LABOR</div>
        <table class="table table-sm table-bordered">
            <thead class="table-light">
                <tr>
                    <th width="10%">Type</th>
                    <th width="50%">Description</th>
                    <th width="10%">Qty</th>
                    <th width="15%">Unit Price</th>
                    <th width="15%">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>{{ item.item_type|title }}</td>
                    <td>{{ item.description }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>${{ "%.2f"|format(item.unit_price) }}</td>
                    <td>${{ "%.2f"|format(item.total_price) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        <!-- Cost Summary -->
        <div class="row mt-3">
            <div class="col-6">
                {% if job_card.notes %}
                <div class="section-title">NOTES</div>
                <div class="border p-2" style="min-height: 80px;">
                    {{ job_card.notes }}
                </div>
                {% endif %}
            </div>
            <div class="col-6">
                <div class="section-title">COST SUMMARY</div>
                <table class="table table-sm table-bordered">
                    <tr>
                        <td><strong>Parts Cost:</strong></td>
                        <td class="text-end">${{ "%.2f"|format(job_card.parts_cost) }}</td>
                    </tr>
                    <tr>
                        <td><strong>Labor Cost:</strong></td>
                        <td class="text-end">${{ "%.2f"|format(job_card.labor_cost) }}</td>
                    </tr>
                    <tr class="table-dark">
                        <td><strong>TOTAL:</strong></td>
                        <td class="text-end"><strong>${{ "%.2f"|format(job_card.total_cost) }}</strong></td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Signatures -->
        <div class="row mt-4">
            <div class="col-4">
                <div class="signature-box">
                    <div style="border-top: 1px solid #333; padding-top: 5px;">
                        Technician Signature
                    </div>
                </div>
            </div>
            <div class="col-4">
                <div class="signature-box">
                    <div style="border-top: 1px solid #333; padding-top: 5px;">
                        Supervisor Signature
                    </div>
                </div>
            </div>
            <div class="col-4">
                <div class="signature-box">
                    <div style="border-top: 1px solid #333; padding-top: 5px;">
                        Customer Signature
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-4 pt-3" style="border-top: 1px solid #ccc; font-size: 10px;">
            <p class="mb-0">Created by: {{ job_card.created_by_name }} | Created on: {{ job_card.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
            <p class="mb-0">This document is computer generated and does not require a signature</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</body>
</html>
