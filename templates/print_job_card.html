{% extends "print_layout.html" %}

{% block title %}Job Card - {{ job_card.job_card_number }}{% endblock %}

{% block document_title %}JOB CARD - {{ job_card.job_card_number }}{% endblock %}

{% block document_meta %}
<strong>Status:</strong> 
<span class="badge bg-{% if job_card.status == 'completed' %}success{% elif job_card.status == 'in_progress' %}info{% elif job_card.status == 'on_hold' %}warning{% else %}secondary{% endif %}">
    {{ job_card.status|replace('_', ' ')|title }}
</span>
<span class="badge bg-{% if job_card.priority == 'urgent' %}danger{% elif job_card.priority == 'high' %}warning{% else %}secondary{% endif %}">
    {{ job_card.priority|title }}
</span><br>
<strong>Created:</strong> {{ job_card.created_at.strftime('%Y-%m-%d %H:%M') if job_card.created_at else 'N/A' }}<br>
<strong>Created By:</strong> {{ job_card.created_by_name if job_card.created_by_name else 'System' }}
{% endblock %}

{% block content %}
<!-- Print Button -->
<div class="no-print text-center mb-3">
    <button onclick="window.print()" class="btn btn-primary btn-lg">
        <i class="bi bi-printer"></i> Print Job Card
    </button>
</div>

        <!-- Vehicle & Customer Info -->
        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div style="flex: 1;">
                <div class="section-title">VEHICLE INFORMATION</div>
                <table class="table table-sm table-bordered">
                    <tr>
                        <td width="40%"><strong>Registration:</strong></td>
                        <td>{{ job_card.vehicle_number }}</td>
                    </tr>
                    <tr>
                        <td><strong>Make/Model:</strong></td>
                        <td>{{ job_card.make }} {{ job_card.model }}</td>
                    </tr>
                    <tr>
                        <td><strong>Year:</strong></td>
                        <td>{{ job_card.year }}</td>
                    </tr>
                    <tr>
                        <td><strong>Color:</strong></td>
                        <td>{{ job_card.color if job_card.color else 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Odometer In:</strong></td>
                        <td>{{ job_card.odometer_in if job_card.odometer_in else 'N/A' }} km</td>
                    </tr>
                    <tr>
                        <td><strong>Odometer Out:</strong></td>
                        <td>{{ job_card.odometer_out if job_card.odometer_out else 'N/A' }} km</td>
                    </tr>
                    <tr>
                        <td><strong>Fuel Level:</strong></td>
                        <td>{{ job_card.fuel_level if job_card.fuel_level else 'Not recorded' }}</td>
                    </tr>
                </table>
            </div>
            <div style="flex: 1;">
                <div class="section-title">CUSTOMER INFORMATION</div>
                <table class="table table-sm table-bordered">
                    <tr>
                        <td width="40%"><strong>Name:</strong></td>
                        <td>{{ job_card.customer_name if job_card.customer_name else 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Phone:</strong></td>
                        <td>{{ job_card.customer_phone if job_card.customer_phone else 'N/A' }}</td>
                    </tr>
                    <tr>
                        <td><strong>Email:</strong></td>
                        <td>{{ job_card.customer_email if job_card.customer_email else 'N/A' }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Service Timeline -->
        <div class="section-title">SERVICE TIMELINE</div>
        <table class="table table-sm table-bordered">
            <tr>
                <td width="20%"><strong>Date In:</strong></td>
                <td width="30%">{{ job_card.date_in.strftime('%Y-%m-%d %H:%M') }}</td>
                <td width="20%"><strong>Expected Completion:</strong></td>
                <td width="30%">{{ job_card.expected_completion.strftime('%Y-%m-%d %H:%M') if job_card.expected_completion else 'Not set' }}</td>
            </tr>
            <tr>
                <td><strong>Date Out:</strong></td>
                <td>{{ job_card.date_out.strftime('%Y-%m-%d %H:%M') if job_card.date_out else 'Not completed' }}</td>
                <td><strong>Assigned Technician:</strong></td>
                <td>{{ job_card.technician_name if job_card.technician_name else 'Unassigned' }}</td>
            </tr>
        </table>

        <!-- Issues & Diagnosis -->
        <div class="section-title">REPORTED ISSUES</div>
        <div class="border p-2 mb-2" style="min-height: 60px;">
            {{ job_card.reported_issues if job_card.reported_issues else 'No issues reported' }}
        </div>

        {% if job_card.diagnosis %}
        <div class="section-title">DIAGNOSIS</div>
        <div class="border p-2 mb-2" style="min-height: 50px;">
            {{ job_card.diagnosis }}
        </div>
        {% endif %}

        {% if job_card.recommended_services %}
        <div class="section-title">RECOMMENDED SERVICES</div>
        <div class="border p-2 mb-2" style="min-height: 50px;">
            {{ job_card.recommended_services }}
        </div>
        {% endif %}

        <!-- Parts & Labor -->
        {% if items %}
        <div class="section-title">PARTS & LABOR</div>
        <table class="table table-sm table-bordered">
            <thead class="table-light">
                <tr>
                    <th width="10%">Type</th>
                    <th width="50%">Description</th>
                    <th width="10%">Qty</th>
                    <th width="15%">Unit Price</th>
                    <th width="15%">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>{{ item.item_type|title }}</td>
                    <td>{{ item.description }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>${{ "%.2f"|format(item.unit_price) }}</td>
                    <td>${{ "%.2f"|format(item.total_price) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        <!-- Cost Summary -->
        <div class="row mt-3">
            <div class="col-6">
                {% if job_card.notes %}
                <div class="section-title">NOTES</div>
                <div class="border p-2" style="min-height: 80px;">
                    {{ job_card.notes }}
                </div>
                {% endif %}
            </div>
            <div class="col-6">
                <div class="section-title">COST SUMMARY</div>
                <table class="table table-sm table-bordered">
                    <tr>
                        <td><strong>Parts Cost:</strong></td>
                        <td class="text-end">${{ "%.2f"|format(job_card.parts_cost) }}</td>
                    </tr>
                    <tr>
                        <td><strong>Labor Cost:</strong></td>
                        <td class="text-end">${{ "%.2f"|format(job_card.labor_cost) }}</td>
                    </tr>
                    <tr class="table-dark">
                        <td><strong>TOTAL:</strong></td>
                        <td class="text-end"><strong>${{ "%.2f"|format(job_card.total_cost) }}</strong></td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Signatures -->
        <div class="row mt-4" style="display: flex; justify-content: space-between; gap: 10px;">
            <div style="flex: 1; border: 1px solid #333; padding: 10px; text-align: center;">
                <div style="min-height: 60px;"></div>
                <div style="border-top: 1px solid #333; padding-top: 5px; margin-top: 5px;">
                    <strong>Technician Signature</strong><br>
                    <small>Name: _________________</small><br>
                    <small>Date: _________________</small>
                </div>
            </div>
            <div style="flex: 1; border: 1px solid #333; padding: 10px; text-align: center;">
                <div style="min-height: 60px;"></div>
                <div style="border-top: 1px solid #333; padding-top: 5px; margin-top: 5px;">
                    <strong>Supervisor Signature</strong><br>
                    <small>Name: _________________</small><br>
                    <small>Date: _________________</small>
                </div>
            </div>
            <div style="flex: 1; border: 1px solid #333; padding: 10px; text-align: center;">
                <div style="min-height: 60px;"></div>
                <div style="border-top: 1px solid #333; padding-top: 5px; margin-top: 5px;">
                    <strong>Customer Signature</strong><br>
                    <small>Name: _________________</small><br>
                    <small>Date: _________________</small>
                </div>
            </div>
        </div>
{% endblock %}
