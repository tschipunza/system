{% extends "print_layout.html" %}

{% block title %}Service Due Notifications Report{% endblock %}

{% block document_title %}SERVICE DUE NOTIFICATIONS{% endblock %}

{% block document_meta %}
<strong>Report Type:</strong> Service Schedule<br>
<strong>Generated By:</strong> {{ session.get('username', 'System') }}
{% endblock %}

{% block content %}
<!-- Print Button (hidden when printing) -->
<div class="no-print text-center mb-3">
    <button onclick="window.print()" class="btn btn-primary btn-lg">
        <i class="bi bi-printer"></i> Print Report
    </button>
</div>
<!-- Summary Section -->
<div class="summary-box">
    <div class="summary-title">Executive Summary</div>
    <div class="summary-row">
        <span>üö® Overdue Service:</span>
        <strong>{{ overdue|length }} vehicles</strong>
    </div>
    <div class="summary-row">
        <span>‚ö†Ô∏è Due Soon (Within 1000 km):</span>
        <strong>{{ due_soon|length }} vehicles</strong>
    </div>
    <div class="summary-row">
        <span>‚úÖ Upcoming Service:</span>
        <strong>{{ upcoming|length }} vehicles</strong>
    </div>
    <div class="summary-row">
        <span>üìã No Service Data:</span>
        <strong>{{ no_data|length }} vehicles</strong>
    </div>
</div>

<!-- Overdue Services -->
{% if overdue %}
<div class="section no-break">
    <div class="section-title">üö® OVERDUE SERVICE ({{ overdue|length }})</div>
    <div class="section-content">
        <table>
            <thead>
                <tr>
                    <th>Vehicle</th>
                    <th>Current Mileage</th>
                    <th>Service Due At</th>
                    <th>Overdue By</th>
                    <th>Last Service</th>
                </tr>
            </thead>
            <tbody>
                {% for vehicle in overdue %}
                <tr>
                    <td>
                        <strong>{{ vehicle.vehicle_number }}</strong><br>
                        <small class="text-muted">{{ vehicle.make }} {{ vehicle.model }} ({{ vehicle.year }})</small>
                    </td>
                    <td>
                        {% if vehicle.latest_mileage %}
                            {{ "{:,}".format(vehicle.latest_mileage) }} km
                        {% else %}
                            <span class="text-muted">No data</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if vehicle.next_service_mileage %}
                            {{ "{:,}".format(vehicle.next_service_mileage) }} km
                        {% endif %}
                        {% if vehicle.next_service_date %}
                            <br><small>{{ vehicle.next_service_date.strftime('%Y-%m-%d') }}</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if vehicle.km_until_service is not none %}
                            <span class="badge badge-danger">{{ "{:,}".format(abs(vehicle.km_until_service)) }} km</span>
                        {% endif %}
                        {% if vehicle.days_until_service is not none and vehicle.days_until_service < 0 %}
                            <br><span class="badge badge-danger">{{ abs(vehicle.days_until_service) }} days</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if vehicle.last_service_type %}
                            {{ vehicle.last_service_type }}<br>
                            <small class="text-muted">{{ vehicle.last_service_date.strftime('%Y-%m-%d') if vehicle.last_service_date else 'N/A' }}</small>
                        {% else %}
                            <span class="text-muted">No history</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- Due Soon Services -->
{% if due_soon %}
<div class="section no-break">
    <div class="section-title">‚ö†Ô∏è DUE SOON (Within 1000 km or 7 days) - {{ due_soon|length }}</div>
    <div class="section-content">
        <table>
            <thead>
                <tr>
                    <th>Vehicle</th>
                    <th>Current Mileage</th>
                    <th>Service Due At</th>
                    <th>Remaining</th>
                    <th>Last Service</th>
                </tr>
            </thead>
            <tbody>
                {% for vehicle in due_soon %}
                <tr>
                    <td>
                        <strong>{{ vehicle.vehicle_number }}</strong><br>
                        <small class="text-muted">{{ vehicle.make }} {{ vehicle.model }} ({{ vehicle.year }})</small>
                    </td>
                    <td>
                        {% if vehicle.latest_mileage %}
                            {{ "{:,}".format(vehicle.latest_mileage) }} km
                        {% else %}
                            <span class="text-muted">No data</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if vehicle.next_service_mileage %}
                            {{ "{:,}".format(vehicle.next_service_mileage) }} km
                        {% endif %}
                        {% if vehicle.next_service_date %}
                            <br><small>{{ vehicle.next_service_date.strftime('%Y-%m-%d') }}</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if vehicle.km_until_service is not none and vehicle.km_until_service > 0 %}
                            <span class="badge badge-warning">{{ "{:,}".format(vehicle.km_until_service) }} km</span>
                        {% endif %}
                        {% if vehicle.days_until_service is not none and vehicle.days_until_service > 0 %}
                            <br><span class="badge badge-warning">{{ vehicle.days_until_service }} days</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if vehicle.last_service_type %}
                            {{ vehicle.last_service_type }}<br>
                            <small class="text-muted">{{ vehicle.last_service_date.strftime('%Y-%m-%d') if vehicle.last_service_date else 'N/A' }}</small>
                        {% else %}
                            <span class="text-muted">No history</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- Upcoming Services -->
{% if upcoming %}
<div class="section no-break">
    <div class="section-title">‚úÖ UPCOMING SERVICE - {{ upcoming|length }}</div>
    <div class="section-content">
        <table>
            <thead>
                <tr>
                    <th>Vehicle</th>
                    <th>Current Mileage</th>
                    <th>Service Due At</th>
                    <th>Remaining</th>
                    <th>Last Service</th>
                </tr>
            </thead>
            <tbody>
                {% for vehicle in upcoming %}
                <tr>
                    <td>
                        <strong>{{ vehicle.vehicle_number }}</strong><br>
                        <small class="text-muted">{{ vehicle.make }} {{ vehicle.model }} ({{ vehicle.year }})</small>
                    </td>
                    <td>
                        {% if vehicle.latest_mileage %}
                            {{ "{:,}".format(vehicle.latest_mileage) }} km
                        {% else %}
                            <span class="text-muted">No data</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if vehicle.next_service_mileage %}
                            {{ "{:,}".format(vehicle.next_service_mileage) }} km
                        {% endif %}
                        {% if vehicle.next_service_date %}
                            <br><small>{{ vehicle.next_service_date.strftime('%Y-%m-%d') }}</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if vehicle.km_until_service is not none %}
                            <span class="badge badge-success">{{ "{:,}".format(vehicle.km_until_service) }} km</span>
                        {% endif %}
                        {% if vehicle.days_until_service is not none %}
                            <br><span class="badge badge-success">{{ vehicle.days_until_service }} days</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if vehicle.last_service_type %}
                            {{ vehicle.last_service_type }}<br>
                            <small class="text-muted">{{ vehicle.last_service_date.strftime('%Y-%m-%d') if vehicle.last_service_date else 'N/A' }}</small>
                        {% else %}
                            <span class="text-muted">No history</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- No Service Data -->
{% if no_data %}
<div class="section no-break">
    <div class="section-title">üìã NO SERVICE DATA - {{ no_data|length }}</div>
    <div class="section-content">
        <p class="text-muted mb-10">These vehicles don't have service schedules set up or fuel tracking data.</p>
        <table>
            <thead>
                <tr>
                    <th>Vehicle</th>
                    <th>Current Mileage</th>
                    <th>Last Service</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for vehicle in no_data %}
                <tr>
                    <td>
                        <strong>{{ vehicle.vehicle_number }}</strong><br>
                        <small class="text-muted">{{ vehicle.make }} {{ vehicle.model }} ({{ vehicle.year }})</small>
                    </td>
                    <td>
                        {% if vehicle.latest_mileage %}
                            {{ "{:,}".format(vehicle.latest_mileage) }} km
                        {% else %}
                            <span class="text-muted">No fuel records</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if vehicle.last_service_type %}
                            {{ vehicle.last_service_type }}<br>
                            <small class="text-muted">{{ vehicle.last_service_date.strftime('%Y-%m-%d') if vehicle.last_service_date else 'N/A' }}</small>
                        {% else %}
                            <span class="text-muted">No service history</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge badge-secondary">Action Required</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

{% if not overdue and not due_soon and not upcoming and not no_data %}
<div class="text-center mt-10">
    <p class="text-muted">No vehicles found. Please add vehicles and service records.</p>
</div>
{% endif %}

{% endblock %}

{% block footer_left %}
Printed by: {{ session.get('username', 'System User') }}
{% endblock %}

{% block footer_center %}
Page <span class="page-number"></span> | Fleet Service Report
{% endblock %}

{% block footer_right %}
CONFIDENTIAL
{% endblock %}
