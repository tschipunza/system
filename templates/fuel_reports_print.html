{% extends "print_layout.html" %}

{% block title %}Fuel Report - {{ start_date }} to {{ end_date }}{% endblock %}

{% block document_title %}FUEL CONSUMPTION REPORT{% endblock %}

{% block document_meta %}
<strong>Report Period:</strong> {{ start_date }} to {{ end_date }}<br>
<strong>Report Type:</strong> {{ report_type|title }}<br>
<strong>Generated By:</strong> {{ session.get('username', 'System') }}
{% endblock %}

{% block content %}
<!-- Print Button -->
<div class="no-print text-center mb-3">
    <button onclick="window.print()" class="btn btn-primary btn-lg">
        <i class="bi bi-printer"></i> Print Report
    </button>
</div>

<!-- Summary Section -->
<div class="summary-box">
    <div class="summary-title">Report Summary</div>
    <div class="summary-row">
        <span>Total Fuel Records:</span>
        <strong>{{ summary.total_records }}</strong>
    </div>
    <div class="summary-row">
        <span>Total Litres Consumed:</span>
        <strong>{{ "%.2f"|format(summary.total_litres) }} L</strong>
    </div>
    <div class="summary-row">
        <span>Total Cost:</span>
        <strong>${{ "%.2f"|format(summary.total_cost) }}</strong>
    </div>
    <div class="summary-row">
        <span>Average Cost per Litre:</span>
        <strong>${{ "%.2f"|format(summary.avg_cost_per_litre) }}</strong>
    </div>
    <div class="summary-row">
        <span>Average Litres per Fill:</span>
        <strong>{{ "%.2f"|format(summary.avg_litres_per_fill) }} L</strong>
    </div>
</div>

<!-- Summary by Vehicle -->
{% if vehicles_summary %}
<div class="section no-break">
    <div class="section-title">SUMMARY BY VEHICLE</div>
    <table>
        <thead>
            <tr>
                <th>Vehicle</th>
                <th>Make/Model</th>
                <th style="text-align: right;">Fills</th>
                <th style="text-align: right;">Total Litres</th>
                <th style="text-align: right;">Total Cost</th>
                <th style="text-align: right;">Distance</th>
                <th style="text-align: right;">L/100km</th>
            </tr>
        </thead>
        <tbody>
            {% for vid, vdata in vehicles_summary.items() %}
            <tr>
                <td><strong>{{ vdata.vehicle_number }}</strong></td>
                <td>{{ vdata.make }} {{ vdata.model }}</td>
                <td style="text-align: right;">{{ vdata.fill_count }}</td>
                <td style="text-align: right;">{{ "%.2f"|format(vdata.total_litres) }}</td>
                <td style="text-align: right;">${{ "%.2f"|format(vdata.total_cost) }}</td>
                <td style="text-align: right;">{{ "{:,}".format(vdata.total_km) if vdata.total_km > 0 else 'N/A' }} km</td>
                <td style="text-align: right;">{{ "%.2f"|format(vdata.avg_consumption) if vdata.avg_consumption > 0 else 'N/A' }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr style="font-weight: bold; background-color: #e0e0e0;">
                <td colspan="2">TOTAL</td>
                <td style="text-align: right;">{{ summary.total_records }}</td>
                <td style="text-align: right;">{{ "%.2f"|format(summary.total_litres) }}</td>
                <td style="text-align: right;">${{ "%.2f"|format(summary.total_cost) }}</td>
                <td colspan="2" style="text-align: right;">-</td>
            </tr>
        </tfoot>
    </table>
</div>
{% endif %}

<!-- Summary by Driver -->
{% if drivers_summary %}
<div class="section no-break" style="margin-top: 20px;">
    <div class="section-title">SUMMARY BY DRIVER</div>
    <table>
        <thead>
            <tr>
                <th>Driver Name</th>
                <th style="text-align: right;">Fill Count</th>
                <th style="text-align: right;">Total Litres</th>
                <th style="text-align: right;">Total Cost</th>
                <th style="text-align: right;">Distance</th>
                <th style="text-align: right;">L/100km</th>
                <th style="text-align: right;">Avg Cost/Fill</th>
            </tr>
        </thead>
        <tbody>
            {% for did, ddata in drivers_summary.items() %}
            <tr>
                <td><strong>{{ ddata.driver_name }}</strong></td>
                <td style="text-align: right;">{{ ddata.fill_count }}</td>
                <td style="text-align: right;">{{ "%.2f"|format(ddata.total_litres) }}</td>
                <td style="text-align: right;">${{ "%.2f"|format(ddata.total_cost) }}</td>
                <td style="text-align: right;">{{ "{:,}".format(ddata.total_km) if ddata.total_km > 0 else 'N/A' }} km</td>
                <td style="text-align: right;">{{ "%.2f"|format(ddata.avg_consumption) if ddata.avg_consumption > 0 else 'N/A' }}</td>
                <td style="text-align: right;">${{ "%.2f"|format(ddata.total_cost / ddata.fill_count) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Detailed Records -->
<div class="section" style="margin-top: 20px;">
    <div class="section-title">DETAILED FUEL RECORDS</div>
    {% if fuel_records %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Vehicle</th>
                <th>Driver</th>
                <th>Station</th>
                <th style="text-align: right;">Odometer</th>
                <th style="text-align: right;">Litres</th>
                <th style="text-align: right;">Price/L</th>
                <th style="text-align: right;">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for record in fuel_records %}
            <tr>
                <td>{{ record.fuel_date.strftime('%Y-%m-%d') }}</td>
                <td>{{ record.vehicle_number }}</td>
                <td>{{ record.driver_name }}</td>
                <td>{{ record.station_name if record.station_name else 'N/A' }}</td>
                <td style="text-align: right;">{{ "{:,}".format(record.odometer_reading) if record.odometer_reading else 'N/A' }}</td>
                <td style="text-align: right;">{{ "%.2f"|format(record.fuel_amount) }}</td>
                <td style="text-align: right;">${{ "%.2f"|format(record.fuel_cost / record.fuel_amount) }}</td>
                <td style="text-align: right;">${{ "%.2f"|format(record.fuel_cost) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; padding: 20px; color: #666;">No fuel records found for the selected period.</p>
    {% endif %}
</div>

<!-- Report Footer Notes -->
<div style="margin-top: 30px; padding: 10px; border-top: 2px solid #333; font-size: 9pt;">
    <p style="margin: 5px 0;"><strong>Notes:</strong></p>
    <ul style="margin: 5px 0; padding-left: 20px;">
        <li>All costs are in USD</li>
        <li>Litres are rounded to 2 decimal places</li>
        <li>Averages are calculated based on actual fills during the period</li>
    </ul>
</div>
{% endblock %}
